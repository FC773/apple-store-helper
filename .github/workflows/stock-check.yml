name: iPhone 17 Pro å®‡å®™æ©™ 256GB è£œè²¨ç›£æ§

on:
  schedule:
    - cron: '*/10 * * * *'  # æ¯ 10 åˆ†é˜åŸ·è¡Œä¸€æ¬¡
  workflow_dispatch:

jobs:
  check_stock:
    runs-on: ubuntu-latest

    steps:
      - name: æª¢æŸ¥ Apple å®˜ç¶²åº«å­˜
        run: |
          # å®‰è£å¿…è¦çš„å·¥å…·
          sudo apt-get update
          sudo apt-get install -y curl jq

          # è¨­å®šåƒæ•¸
          REGION="tw"
          MODEL="iphone17pro"
          COLOR="orange"
          CAPACITY="256gb"
          STORES=("R401" "R425")  # å°åŒ— 101 å’Œä¿¡ç¾© A13 å…©å®¶ç›´ç‡Ÿåº—
          BARK_URL="https://api.day.app/31d531f61ded93fd8884969a60bf595ee94631c3475ffeadd534bc2864993f79/"

          # æª¢æŸ¥åº«å­˜
          for STORE in "${STORES[@]}"; do
            RESPONSE=$(curl -s "https://www.apple.com/tw/shop/retail/${STORE}/availability.json?product=${MODEL}&color=${COLOR}&capacity=${CAPACITY}")
            STOCK=$(echo "$RESPONSE" | jq '.availability')
            if [[ "$STOCK" == "true" ]]; then
              MESSAGE="ğŸ‰ ${STORE} æœ‰è²¨ï¼"
              curl -s "${BARK_URL}${MESSAGE}"
            fi
          done
