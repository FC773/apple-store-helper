name: iPhone 17 Pro 宇宙橙 256GB 補貨監控

on:
  schedule:
    - cron: '*/10 * * * *'  # 每 10 分鐘執行一次
  workflow_dispatch:

jobs:
  check_stock:
    runs-on: ubuntu-latest

    steps:
      - name: 檢查 Apple 官網庫存
        run: |
          # 安裝必要的工具
          sudo apt-get update
          sudo apt-get install -y curl jq

          # 設定參數
          REGION="tw"
          MODEL="iphone17pro"
          COLOR="orange"
          CAPACITY="256gb"
          STORES=("R401" "R425")  # 台北 101 和信義 A13 兩家直營店
          BARK_URL="https://api.day.app/31d531f61ded93fd8884969a60bf595ee94631c3475ffeadd534bc2864993f79/"

          # 檢查庫存
          for STORE in "${STORES[@]}"; do
            RESPONSE=$(curl -s "https://www.apple.com/tw/shop/retail/${STORE}/availability.json?product=${MODEL}&color=${COLOR}&capacity=${CAPACITY}")
            STOCK=$(echo "$RESPONSE" | jq '.availability')
            if [[ "$STOCK" == "true" ]]; then
              MESSAGE="🎉 ${STORE} 有貨！"
              curl -s "${BARK_URL}${MESSAGE}"
            fi
          done
